<!-- cars.component.html -->
<div class="app-container">
  <!-- Header Section -->
  <div class="header-actions">
    <div>
      <h1 class="title">Cars</h1>
      <h3 class="subtitle">Number of cars rented: {{ totalRentedCars }}</h3>
      <h3 class="subtitle">
        Number of cars available: {{ totalCount - totalRentedCars }}
      </h3>
    </div>

    <div class="filter-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Cars</mat-label>
        <input matInput [(ngModel)]="filter['search_query']" (keyup.enter)="applyFilter()" (input)="onSearchInput()"
          placeholder="Search by plate, brand, model..." />
        <mat-icon matSuffix *ngIf="!filter['search_query']">search</mat-icon>
        <button mat-icon-button matSuffix *ngIf="filter['search_query']" (click)="clearSearch()"
          matTooltip="Clear search">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="applyFilter()" [disabled]="!filter['search_query']">
        <mat-icon>search</mat-icon>
        Search
      </button>
    </div>

    <div class="action-section">
      <button mat-raised-button color="warn" (click)="pageRel()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>

      <button mat-raised-button color="primary" (click)="addCar()">
        <mat-icon>add</mat-icon>
        Add Car
      </button>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading cars...</p>
  </div>

  <!-- Cars Table -->
  <div class="table-wrapper" *ngIf="!isLoading">
    <table mat-table [dataSource]="dataSource" class="app-table">
      <!-- Plate Column -->
      <ng-container matColumnDef="Plate">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Plate Number</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          <span class="app-plate">{{ car.plate }}</span>
        </td>
      </ng-container>

      <!-- Brand Column -->
      <ng-container matColumnDef="Brand">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Brand</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          {{ car.brand || "N/A" }}
        </td>
      </ng-container>

      <!-- Class Column -->
      <ng-container matColumnDef="Class">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Class</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          {{ car.class || "N/A" }}
        </td>
      </ng-container>

      <!-- Model Column -->
      <ng-container matColumnDef="Model">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Model</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          {{ car.model || "N/A" }}
        </td>
      </ng-container>

      <!-- Color Column -->
      <ng-container matColumnDef="Color">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Color</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          {{ car.color || "N/A" }}
        </td>
      </ng-container>

      <!-- Status Column (NEW) -->
      <ng-container matColumnDef="Status">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Status</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          <div class="status-container">
            <span class="status-badge active" *ngIf="!car.statusInfo?.isRented">
              Available
            </span>
            <span class="status-badge rented" *ngIf="car.statusInfo?.isRented">
              <div>Available: {{ car.statusInfo?.checkIn | date:'MMM d, y' }}</div>
              <div class="customer-name">{{ car.statusInfo?.customerName }}</div>
            </span>
          </div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Actions</strong>
        </th>
        <td mat-cell *matCellDef="let car">
          <div class="action-buttons">
            <!-- Quick Actions -->
            <button mat-icon-button color="primary" (click)="editCar(car)" matTooltip="Edit Car">
              <mat-icon>edit</mat-icon>
            </button>

            <button mat-icon-button color="accent" (click)="viewContract(car)" *ngIf="car.statusInfo?.isRented"
              matTooltip="View Contract">
              <mat-icon>visibility</mat-icon>
            </button>

            <!-- More Actions Menu -->
            <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="More Actions">
              <mat-icon>more_vert</mat-icon>
            </button>

            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="viewCarDetails(car)">
                <mat-icon>info</mat-icon>
                <span>Car Details</span>
              </button>

              <button mat-menu-item (click)="viewHistory(car)">
                <mat-icon>history</mat-icon>
                <span>Rental History</span>
              </button>

              <button mat-menu-item (click)="newBooking(car)">
                <mat-icon>add</mat-icon>
                <span>New booking</span>
              </button>

              <mat-divider></mat-divider>

              <!-- <button mat-menu-item 
                      (click)="deleteCar(car)" 
                      [disabled]="car.statusInfo?.isRented"
                      class="delete-action">
                <mat-icon>delete</mat-icon>
                <span>Delete Car</span>
              </button> -->
            </mat-menu>
          </div>
        </td>
      </ng-container>

      <!-- Table Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>
    </table>

    <!-- No Data Message -->
    <div *ngIf="dataSource.data.length === 0" class="no-data">
      <mat-icon>directions_car</mat-icon>
      <h3>No cars found</h3>
      <p>Try adjusting your search criteria or add a new car.</p>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator *ngIf="!isLoading && dataSource.data.length > 0" [length]="totalCount" [pageSize]="pageSize"
    [pageIndex]="currentPage" [pageSizeOptions]="[5, 10, 25, 50, 100]" (page)="onPageChange($event)"
    showFirstLastButtons class="table-paginator">
  </mat-paginator>
</div>