<h2 mat-dialog-title>Add New Contract</h2>
<mat-dialog-content>
  <form>

    <!-- Add New Customer Checkbox -->
    <mat-checkbox name="addNewCustomer" [(ngModel)]="newCustomer"  class="full-width">
      Add New Customer
    </mat-checkbox>

    <mat-form-field *ngIf="!newCustomer" appearance="outline" class="half-width">
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="contract['name']"
             [matAutocomplete]="auto"
             [ngModelOptions]="{standalone: true}"
             (ngModelChange)="onNameChange($event)" (ngModelChange)="formValidation()" required>

      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectCustomer($event)">
        <mat-option *ngFor="let customer of customerSuggestions" [value]="customer.fullName">
          {{ customer.fullName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Plate</mat-label>
      <input matInput type="number" [(ngModel)]="contract['car']" [ngModelOptions]="{standalone: true}" required (ngModelChange)="formValidation()">
    </mat-form-field>

    <!-- New Customer Section -->
    <div *ngIf="newCustomer">
      <mat-form-field appearance="outline" class="quart-width">
        <mat-label>First Name</mat-label>
        <input matInput [(ngModel)]="contract['firstName']" required [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
      </mat-form-field>

      <mat-form-field appearance="outline" class="quart-width">
        <mat-label>Middle Name</mat-label>
        <input matInput [(ngModel)]="contract['middleName']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
      </mat-form-field>

      <mat-form-field appearance="outline" class="quart-width">
        <mat-label>Last Name</mat-label>
        <input matInput  [(ngModel)]="contract['lastName']" required [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
      </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Nationality</mat-label>
          <mat-select class="form-select" name="nationalityId" id="nationalityId" [(ngModel)]="contract['nationalityId']" required >
            <mat-option *ngFor="let n of Nationalities;" [value]="n.id">{{ n.name }}</mat-option>
          </mat-select>
          
        </mat-form-field>

      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Phone number</mat-label>
        <input matInput [(ngModel)]="contract['PhoneNumber']" required [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
      </mat-form-field>
    </div>

    <!-- ... remaining form fields stay the same ... -->


    <mat-form-field appearance="outline" class="half-width">
        <mat-label [ngStyle]="{'color': !contract['form_isValid'] && !contract['pickout'] ? 'red' : ''}">Pick Out</mat-label>
        <input matInput [matDatepicker]="picker1" type="text" [(ngModel)]="contract['pickout']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()" >
        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="half-width">
        <mat-label [ngStyle]="{'color': !contract['form_isValid'] && !contract['dropin'] ? 'red' : ''}">Drop In</mat-label>
        <input [min]="contract['pickout']" matInput [matDatepicker]="picker" type="text" [(ngModel)]="contract['dropin']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="quart-width">
        <mat-label>Price</mat-label>
        <input matInput [(ngModel)]="contract['price']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
    </mat-form-field>

    <mat-form-field appearance="outline" class="quart-width">
        <mat-label>Paid</mat-label>
        <input matInput [(ngModel)]="contract['paid']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
    </mat-form-field>

    <mat-form-field appearance="outline" class="quart-width">
        <mat-label>Deposit</mat-label>
        <input matInput [(ngModel)]="contract['deposit']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
        <mat-label>Note</mat-label>
        <input matInput [(ngModel)]="contract['note']" [ngModelOptions]="{standalone: true}" (ngModelChange)="formValidation()">
    </mat-form-field>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Cancel</button>
  <button mat-button color="primary" [disabled]="!contract['form_isValid'] || !contract['form_isComplete']" [mat-dialog-close]="this.contract">Save</button>
</mat-dialog-actions>
